---
title: "EDA Budweiser dataset"
author: "jjsmu"
date: "10/8/2023"
output: html_document

#1.	How many breweries are present in each state?
#2.	Merge beer data with the breweries data. Print the first 6 observations and the last six observations to check the merged file.  (RMD only, this does not need to be included in the presentation or the deck.)
#3.	Address the missing values in each column.
#4.	Compute the median alcohol content and international bitterness unit for each state. Plot a bar chart to compare.
#5.	Which state has the maximum alcoholic (ABV) beer? Which state has the most bitter (IBU) beer?
#6.	Comment on the summary statistics and distribution of the ABV variable.
#7.	Is there an apparent relationship between the bitterness of the beer and its alcoholic content? Draw a scatter plot.  Make your best judgment of a relationship and EXPLAIN your answer.
#8.	Budweiser would also like to investigate the difference with respect to IBU and ABV between IPAs (India Pale Ales) and other types of Ale (any beer with “Ale” in its name other than IPA).  You decide to use KNN classification to investigate this relationship.  Provide statistical evidence one way or the other. You can of course assume your audience is comfortable with percentages … KNN is very easy to understand conceptually. 
#In addition, while you have decided to use KNN to investigate this relationship (KNN is required) you may also feel free to supplement your response to this question with any other methods or techniques you have learned.  Creativity and alternative solutions are always encouraged.  

#9.	Knock their socks off!  Find one other useful inference from the data that you feel Budweiser may be able to find value in.  You must convince them why it is important and back up your conviction with appropriate statistical evidence. 

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# R libraries
#install.packages(dplyr)
library(dplyr)
#install.packages(ggplot)
library(ggplot2)
#install.packages("tidyverse")
library(tidyverse)
```
# PART I Import data

```{r}
# read the csv files
BEERS = read.csv(file.choose(), header = TRUE)
BREWERIES = read.csv(file.choose(), header = TRUE)
# check first five rows
head(BEERS, n = 5)
head(BREWERIES, n = 5)
# look at data frame
str(BEERS)
str(BREWERIES)
```

# PART II EDA Visualization
# 1.	How many breweries are present in each state?
```{r}
# visualization

# display summary statistics
summary(BEERS)
summary(BREWERIES)

# full table view
View(BEERS)
View(BREWERIES)

# view count of breweries by state
breweries_by_state <- BREWERIES %>% 
  group_by (State) %>%
  summarize (Count = n()) %>%
  arrange (desc(Count))
View(breweries_by_state)

# total number of breweries in US
total_breweries <- sum(breweries_by_state$Count)

# ggplot2 bar plot of breweries by state
barplot_of_breweries_by_state <- BREWERIES %>%
  group_by(State) %>%
  ggplot(aes(State)) + geom_bar(stat = "count") +
  ggtitle(paste("Barplot of Breweries by State (US), n = ", total_breweries)) +
  xlab("State") + ylab("Count") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
barplot_of_breweries_by_state

box_plot_breweries_by_state 

#hist(BEERS$Ounces, main = paste("Histogram of Beers by Volume (Ounce), n = ", length(table(beerOunceAsFactor))), xlab = "Volume (oz.)", ylab = "Frequency", col = "lightblue", border = "black")

#plot(BEERS$Beer_ID, BEERS$ABV, pch = 15, xlab = "Beer_ID", ylab = "ABV(%)", main = paste("Beer_ID v. ABV, n = ", length(BEERS$Beer_ID)))

```
# PART II
# 2. 	Merge beer data with the breweries data. Print the first 6 observations and the last six observations to check the merged file.  (RMD only, this does not need to be included in the presentation or the deck.)
```{r}
# full merge beer and breweries data frames 
BEER_AND_BREWERIES <- merge(BEERS, BREWERIES, by.x = "Brewery_id", by.y = "Brew_ID", all = TRUE) %>%
  rename(Beer = Name.x, Brewery = Name.y)
# view complete table
View(BEER_AND_BREWERIES)
# print the first 6 observations
print(head(BEER_AND_BREWERIES, n = 6))
# print the last 6 observations
print(tail(BEER_AND_BREWERIES, n = 6))
```

# PART III
# 3.	Address the missing values in each column.
```{r}

# tidy data
library(naniar)

# plot missing variables
gg_miss_var(BEERS) # IBU, ABV Missing
gg_miss_var(BREWERIES) 
gg_miss_var(BEER_AND_BREWERIES)

# test for NA values
sum(is.na(BEERS$ABV)) # missing 62 values
sum(is.na(BEERS$IBU)) # missing 1005 values
sum(is.na(BEER_AND_BREWERIES)) # missing 1067 values

# find the missing NA value indexes
grep()

# test the function complete.cases() on gg_miss_var
gg_miss_var(BEERS[complete.cases(BEERS$IBU, BEERS$ABV), ])

# replace missing NA values with new value
# BEERS <- BEERS[complete.cases(BEERS$IBU, BEERS$ABV), ]

# TODO Plot with/without missing NA values ABV, IBU, check for skewness
```
# PART IV 
# 4. Compute the median alcohol content and international bitterness unit for each state. Plot a bar chart to compare.

```{r}
median_by_state <- BEER_AND_BREWERIES %>%
  group_by(State) %>%
  filter(!is.na(ABV) & !is.na(IBU)) %>%
  summarize(median_ABV = median(ABV), median_IBU = median(IBU))
median_by_state

total_states <- count(median_by_state)

barplot_median_abv <- median_by_state %>%
  ggplot(aes(State, median_ABV, color = median_ABV, fill = median_ABV)) + 
  geom_bar(stat = "identity") +
  ggtitle(paste("Barplot of Median Alcohol by Volume (% ABV) by State (US), n = ", total_states)) +
  xlab("State") + ylab("Median ABV (%)") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
barplot_median_abv

barplot_median_ibu <- median_by_state %>%
  ggplot(aes(State, median_IBU, color = median_IBU, fill = median_IBU)) +
  geom_bar(stat = "identity") + 
  ggtitle(paste("Barplot of Median Internation Bitterness Unit (IBU) by State (US), n = ", total_states)) +
  xlab("State") + ylab("Median IBU") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

barplot_median_ibu

```
# PART V
#5.	Which state has the maximum alcoholic (ABV) beer? Which state has the most bitter (IBU) beer?
```{r}

# group filter and summarize max abv and ibu values
max_by_state <- BEER_AND_BREWERIES %>%
  group_by(State) %>%
  filter(!is.na(ABV) & !is.na(IBU)) %>%
  summarize(max_ABV = max(ABV), max_IBU = max(IBU))
max_by_state  

barplot_max_abv <- max_by_state %>%
  ggplot(aes(State, max_ABV, color = max_ABV, fill = max_ABV)) +
  geom_bar(stat = "identity") + 
  ggtitle(paste("Barplot of Maximum Alcohol by Volume (% ABV) by State (US), n = ", total_states)) +
  xlab("State") + ylab("Max ABV (%)") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
barplot_max_abv

barplot_max_ibu <- max_by_state %>%
  ggplot(aes(State, max_IBU, color = max_IBU, fill = max_IBU)) +
  geom_bar(stat = "identity") + 
  ggtitle(paste("Barplot of Maximum Internation Bitterness Unit (IBU) by State (US), n = ", total_states)) +
  xlab("State") + ylab("Maximum IBU") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
barplot_max_ibu

# store max abv and ibu index
max_abv <- which.max(max_by_state$max_ABV)
max_ibu <- which.max(max_by_state$max_IBU)

# find max abv and ibu state by index
max_abv_state <- max_by_state$State[max_abv]
max_ibu_state <- max_by_state$State[max_ibu]

# console output max abv and ibu
max_abv_state
max_ibu_state

library(maps)
library(mapproj)
# plot map data for Count, ABV, IBU
mapData <- count(BEER_AND_BREWERIES, State)
colnames(mapData)[2] = "Total_Breweries"
str(mapData)

lookup = data.frame(abb = state.abb, State = state.name) #makes a data frame with State name and abbreviation. 
colnames(lookup)[1] = "State"
colnames(lookup)[2] = "Name"
str(lookup)

joined_data <- full_join(mapData, lookup, by = "State")

states <- map_data("state")

map.df <- merge(states, joined_data, all.x = T)
```

# PART VI
# 6.	Comment on the summary statistics and distribution of the ABV variable.
```{r}

# Comments:

total_beers <- count(BEER_AND_BREWERIES)
hist_abv <- BEER_AND_BREWERIES %>%
  select(Beer, ABV, Style, Ounces, Brewery) %>%
  filter(!is.na(ABV)) %>%
  ggplot(aes(ABV)) + geom_histogram() +
  ggtitle(paste("Histogram of Alcohol by Volume (% ABV), n = ", total_beers)) +
  xlab("ABV") + ylab("Frequency")
hist_abv

hist_ibu <- BEER_AND_BREWERIES %>%
  select(Beer, IBU, Style, Ounces, Brewery) %>%
  filter(!is.na(IBU)) %>%
  ggplot(aes(IBU)) + geom_histogram(stat = "bin", bins = 50) +
  ggtitle(paste("Histogram of International Bitterness Units (IBU), n = ", total_beers)) +
  xlab("IBU") + ylab("Frequency")
hist_ibu

# box plot of ABV by Beer Style
boxplot(BEERS$ABV~BEERS$Style, las = 2, names.arg = BEERS$Style, main = paste("Boxplot of Alcohol by Volume by Style, n = ", length(BEERS$Style)), xlab = "Beer Style", ylab = "ABV(%)")
# box plot of IBU by Beer Style
boxplot(BEERS$IBU~BEERS$Style, las = 2, names.arg = BEERS$Style, main = paste("Boxplot of International Bitterness Units (IBU) by Style, n = ", length(BEERS$Style)), xlab = "Beer Style", ylab = "IBU")

```

# PART VII
# 7.	Is there an apparent relationship between the bitterness of the beer and its alcoholic content? Draw a scatter plot.  Make your best judgment of a relationship and EXPLAIN your answer.
```{r}

library(GGally)


```

# PART VIII
#8.	Budweiser would also like to investigate the difference with respect to IBU and ABV between IPAs (India Pale Ales) and other types of Ale (any beer with “Ale” in its name other than IPA).  You decide to use KNN classification to investigate this relationship.  Provide statistical evidence one way or the other. You can of course assume your audience is comfortable with percentages … KNN is very easy to understand conceptually. 
#In addition, while you have decided to use KNN to investigate this relationship (KNN is required) you may also feel free to supplement your response to this question with any other methods or techniques you have learned.  Creativity and alternative solutions are always encouraged.  

```{r}
#install package and load library
install.packages("class")
install.packages("caret")
install.packages("e1071")
library(class)
library(caret)
library(e1071)


```

# PART IX
#9.	Knock their socks off!  Find one other useful inference from the data that you feel Budweiser may be able to find value in.  You must convince them why it is important and back up your conviction with appropriate statistical evidence. 

```{r}
# use of themes and advanced plots
# eda 1: number of breweries v. median ibu
```

